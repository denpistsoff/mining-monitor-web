{"ast":null,"code":"import { initializeApp } from 'firebase/app';\nimport { getDatabase, ref, onValue, off, set } from 'firebase/database';\n\n// Конфигурация Firebase\nconst firebaseConfig = {\n  databaseURL: 'https://mining-monitor-api-default-rtdb.firebaseio.com/'\n};\n\n// Инициализация Firebase\nconst app = initializeApp(firebaseConfig);\nexport const database = getDatabase(app);\nexport class MiningMonitorAPI {\n  constructor(farmName) {\n    this.farmName = farmName;\n    this.listeners = new Map();\n  }\n\n  // Реальная подписка на данные фермы\n  subscribeToFarmData(callback) {\n    const farmRef = ref(database, `farms/${this.farmName}`);\n    const unsubscribe = onValue(farmRef, snapshot => {\n      const data = snapshot.val();\n      callback(data);\n    }, error => {\n      console.error('Ошибка подписки на данные фермы:', error);\n    });\n    this.listeners.set('farmData', unsubscribe);\n    return unsubscribe;\n  }\n\n  // Подписка на данные майнеров\n  subscribeToMiners(callback) {\n    const minersRef = ref(database, `miners/${this.farmName}`);\n    const unsubscribe = onValue(minersRef, snapshot => {\n      const data = snapshot.val();\n      callback(data);\n    }, error => {\n      console.error('Ошибка подписки на данные майнеров:', error);\n    });\n    this.listeners.set('miners', unsubscribe);\n    return unsubscribe;\n  }\n\n  // Подписка на оповещения\n  subscribeToAlerts(callback) {\n    const alertsRef = ref(database, `alerts/${this.farmName}`);\n    const unsubscribe = onValue(alertsRef, snapshot => {\n      const data = snapshot.val();\n      callback(data || {});\n    }, error => {\n      console.error('Ошибка подписки на оповещения:', error);\n    });\n    this.listeners.set('alerts', unsubscribe);\n    return unsubscribe;\n  }\n\n  // Отметить оповещение как прочитанное\n  markAlertRead(alertId) {\n    const alertRef = ref(database, `alerts/${this.farmName}/${alertId}/read`);\n    set(alertRef, true).catch(error => {\n      console.error('Ошибка отметки оповещения:', error);\n    });\n  }\n\n  // Отправить команду майнеру\n  sendMinerCommand(minerIp, command) {\n    const commandRef = ref(database, `commands/${this.farmName}/${minerIp}`);\n    return set(commandRef, {\n      command: command,\n      timestamp: Date.now(),\n      status: 'pending'\n    });\n  }\n\n  // Отписаться от всех обновлений\n  unsubscribeAll() {\n    this.listeners.forEach((unsubscribe, key) => {\n      unsubscribe();\n      console.log(`Отписались от: ${key}`);\n    });\n    this.listeners.clear();\n  }\n\n  // Получить историю данных\n  getHistoricalData(days = 7) {\n    // Здесь можно добавить логику для получения исторических данных\n    return new Promise(resolve => {\n      resolve([]);\n    });\n  }\n}\n\n// Вспомогательные функции\nexport const formatHashrate = hashrate => {\n  if (!hashrate) return '0 TH/s';\n  if (hashrate >= 1000) {\n    return `${(hashrate / 1000).toFixed(2)} PH/s`;\n  }\n  return `${hashrate.toFixed(2)} TH/s`;\n};\nexport const formatPower = power => {\n  if (!power) return '0 Вт';\n  if (power >= 1000) {\n    return `${(power / 1000).toFixed(1)} кВт`;\n  }\n  return `${power} Вт`;\n};\nexport const calculateEfficiency = (hashrate, power) => {\n  if (!hashrate || !power || power === 0) return 0;\n  return hashrate / power * 1000; // J/TH\n};\nexport const getStatusColor = status => {\n  const colors = {\n    online: '#10b981',\n    offline: '#ef4444',\n    problematic: '#f59e0b',\n    warning: '#f59e0b',\n    critical: '#dc2626'\n  };\n  return colors[status] || '#6b7280';\n};","map":{"version":3,"names":["initializeApp","getDatabase","ref","onValue","off","set","firebaseConfig","databaseURL","app","database","MiningMonitorAPI","constructor","farmName","listeners","Map","subscribeToFarmData","callback","farmRef","unsubscribe","snapshot","data","val","error","console","subscribeToMiners","minersRef","subscribeToAlerts","alertsRef","markAlertRead","alertId","alertRef","catch","sendMinerCommand","minerIp","command","commandRef","timestamp","Date","now","status","unsubscribeAll","forEach","key","log","clear","getHistoricalData","days","Promise","resolve","formatHashrate","hashrate","toFixed","formatPower","power","calculateEfficiency","getStatusColor","colors","online","offline","problematic","warning","critical"],"sources":["C:/Users/vapcbuild/Desktop/monitorASIC/web-dashboard/mining-monitor-web/src/utils/firebase.js"],"sourcesContent":["import { initializeApp } from 'firebase/app';\r\nimport { getDatabase, ref, onValue, off, set } from 'firebase/database';\r\n\r\n// Конфигурация Firebase\r\nconst firebaseConfig = {\r\n    databaseURL: 'https://mining-monitor-api-default-rtdb.firebaseio.com/'\r\n};\r\n\r\n// Инициализация Firebase\r\nconst app = initializeApp(firebaseConfig);\r\nexport const database = getDatabase(app);\r\n\r\nexport class MiningMonitorAPI {\r\n    constructor(farmName) {\r\n        this.farmName = farmName;\r\n        this.listeners = new Map();\r\n    }\r\n\r\n    // Реальная подписка на данные фермы\r\n    subscribeToFarmData(callback) {\r\n        const farmRef = ref(database, `farms/${this.farmName}`);\r\n        \r\n        const unsubscribe = onValue(farmRef, (snapshot) => {\r\n            const data = snapshot.val();\r\n            callback(data);\r\n        }, (error) => {\r\n            console.error('Ошибка подписки на данные фермы:', error);\r\n        });\r\n\r\n        this.listeners.set('farmData', unsubscribe);\r\n        return unsubscribe;\r\n    }\r\n\r\n    // Подписка на данные майнеров\r\n    subscribeToMiners(callback) {\r\n        const minersRef = ref(database, `miners/${this.farmName}`);\r\n        \r\n        const unsubscribe = onValue(minersRef, (snapshot) => {\r\n            const data = snapshot.val();\r\n            callback(data);\r\n        }, (error) => {\r\n            console.error('Ошибка подписки на данные майнеров:', error);\r\n        });\r\n\r\n        this.listeners.set('miners', unsubscribe);\r\n        return unsubscribe;\r\n    }\r\n\r\n    // Подписка на оповещения\r\n    subscribeToAlerts(callback) {\r\n        const alertsRef = ref(database, `alerts/${this.farmName}`);\r\n        \r\n        const unsubscribe = onValue(alertsRef, (snapshot) => {\r\n            const data = snapshot.val();\r\n            callback(data || {});\r\n        }, (error) => {\r\n            console.error('Ошибка подписки на оповещения:', error);\r\n        });\r\n\r\n        this.listeners.set('alerts', unsubscribe);\r\n        return unsubscribe;\r\n    }\r\n\r\n    // Отметить оповещение как прочитанное\r\n    markAlertRead(alertId) {\r\n        const alertRef = ref(database, `alerts/${this.farmName}/${alertId}/read`);\r\n        set(alertRef, true).catch(error => {\r\n            console.error('Ошибка отметки оповещения:', error);\r\n        });\r\n    }\r\n\r\n    // Отправить команду майнеру\r\n    sendMinerCommand(minerIp, command) {\r\n        const commandRef = ref(database, `commands/${this.farmName}/${minerIp}`);\r\n        return set(commandRef, {\r\n            command: command,\r\n            timestamp: Date.now(),\r\n            status: 'pending'\r\n        });\r\n    }\r\n\r\n    // Отписаться от всех обновлений\r\n    unsubscribeAll() {\r\n        this.listeners.forEach((unsubscribe, key) => {\r\n            unsubscribe();\r\n            console.log(`Отписались от: ${key}`);\r\n        });\r\n        this.listeners.clear();\r\n    }\r\n\r\n    // Получить историю данных\r\n    getHistoricalData(days = 7) {\r\n        // Здесь можно добавить логику для получения исторических данных\r\n        return new Promise((resolve) => {\r\n            resolve([]);\r\n        });\r\n    }\r\n}\r\n\r\n// Вспомогательные функции\r\nexport const formatHashrate = (hashrate) => {\r\n    if (!hashrate) return '0 TH/s';\r\n    \r\n    if (hashrate >= 1000) {\r\n        return `${(hashrate / 1000).toFixed(2)} PH/s`;\r\n    }\r\n    return `${hashrate.toFixed(2)} TH/s`;\r\n};\r\n\r\nexport const formatPower = (power) => {\r\n    if (!power) return '0 Вт';\r\n    \r\n    if (power >= 1000) {\r\n        return `${(power / 1000).toFixed(1)} кВт`;\r\n    }\r\n    return `${power} Вт`;\r\n};\r\n\r\nexport const calculateEfficiency = (hashrate, power) => {\r\n    if (!hashrate || !power || power === 0) return 0;\r\n    return (hashrate / power) * 1000; // J/TH\r\n};\r\n\r\nexport const getStatusColor = (status) => {\r\n    const colors = {\r\n        online: '#10b981',\r\n        offline: '#ef4444',\r\n        problematic: '#f59e0b',\r\n        warning: '#f59e0b',\r\n        critical: '#dc2626'\r\n    };\r\n    return colors[status] || '#6b7280';\r\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
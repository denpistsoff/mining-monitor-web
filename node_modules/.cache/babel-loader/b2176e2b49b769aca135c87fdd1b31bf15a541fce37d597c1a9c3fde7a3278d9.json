{"ast":null,"code":"import{initializeApp}from'firebase/app';import{getDatabase,ref,onValue,off,set}from'firebase/database';// Конфигурация Firebase\nconst firebaseConfig={databaseURL:'https://mining-monitor-api-default-rtdb.firebaseio.com/'};// Инициализация Firebase\nconst app=initializeApp(firebaseConfig);export const database=getDatabase(app);export class MiningMonitorAPI{constructor(farmName){this.farmName=farmName;this.listeners=new Map();}// Реальная подписка на данные фермы\nsubscribeToFarmData(callback){const farmRef=ref(database,\"farms/\".concat(this.farmName));const unsubscribe=onValue(farmRef,snapshot=>{const data=snapshot.val();callback(data);},error=>{console.error('Ошибка подписки на данные фермы:',error);});this.listeners.set('farmData',unsubscribe);return unsubscribe;}// Подписка на данные майнеров\nsubscribeToMiners(callback){const minersRef=ref(database,\"miners/\".concat(this.farmName));const unsubscribe=onValue(minersRef,snapshot=>{const data=snapshot.val();callback(data);},error=>{console.error('Ошибка подписки на данные майнеров:',error);});this.listeners.set('miners',unsubscribe);return unsubscribe;}// Подписка на оповещения\nsubscribeToAlerts(callback){const alertsRef=ref(database,\"alerts/\".concat(this.farmName));const unsubscribe=onValue(alertsRef,snapshot=>{const data=snapshot.val();callback(data||{});},error=>{console.error('Ошибка подписки на оповещения:',error);});this.listeners.set('alerts',unsubscribe);return unsubscribe;}// Отметить оповещение как прочитанное\nmarkAlertRead(alertId){const alertRef=ref(database,\"alerts/\".concat(this.farmName,\"/\").concat(alertId,\"/read\"));set(alertRef,true).catch(error=>{console.error('Ошибка отметки оповещения:',error);});}// Отправить команду майнеру\nsendMinerCommand(minerIp,command){const commandRef=ref(database,\"commands/\".concat(this.farmName,\"/\").concat(minerIp));return set(commandRef,{command:command,timestamp:Date.now(),status:'pending'});}// Отписаться от всех обновлений\nunsubscribeAll(){this.listeners.forEach((unsubscribe,key)=>{unsubscribe();console.log(\"\\u041E\\u0442\\u043F\\u0438\\u0441\\u0430\\u043B\\u0438\\u0441\\u044C \\u043E\\u0442: \".concat(key));});this.listeners.clear();}// Получить историю данных\ngetHistoricalData(){let days=arguments.length>0&&arguments[0]!==undefined?arguments[0]:7;// Здесь можно добавить логику для получения исторических данных\nreturn new Promise(resolve=>{resolve([]);});}}// Вспомогательные функции\nexport const formatHashrate=hashrate=>{if(!hashrate)return'0 TH/s';if(hashrate>=1000){return\"\".concat((hashrate/1000).toFixed(2),\" PH/s\");}return\"\".concat(hashrate.toFixed(2),\" TH/s\");};export const formatPower=power=>{if(!power)return'0 Вт';if(power>=1000){return\"\".concat((power/1000).toFixed(1),\" \\u043A\\u0412\\u0442\");}return\"\".concat(power,\" \\u0412\\u0442\");};export const calculateEfficiency=(hashrate,power)=>{if(!hashrate||!power||power===0)return 0;return hashrate/power*1000;// J/TH\n};export const getStatusColor=status=>{const colors={online:'#10b981',offline:'#ef4444',problematic:'#f59e0b',warning:'#f59e0b',critical:'#dc2626'};return colors[status]||'#6b7280';};","map":{"version":3,"names":["initializeApp","getDatabase","ref","onValue","off","set","firebaseConfig","databaseURL","app","database","MiningMonitorAPI","constructor","farmName","listeners","Map","subscribeToFarmData","callback","farmRef","concat","unsubscribe","snapshot","data","val","error","console","subscribeToMiners","minersRef","subscribeToAlerts","alertsRef","markAlertRead","alertId","alertRef","catch","sendMinerCommand","minerIp","command","commandRef","timestamp","Date","now","status","unsubscribeAll","forEach","key","log","clear","getHistoricalData","days","arguments","length","undefined","Promise","resolve","formatHashrate","hashrate","toFixed","formatPower","power","calculateEfficiency","getStatusColor","colors","online","offline","problematic","warning","critical"],"sources":["C:/Users/vapcbuild/Desktop/monitorASIC/web-dashboard/mining-monitor-web/src/utils/firebase.js"],"sourcesContent":["import { initializeApp } from 'firebase/app';\r\nimport { getDatabase, ref, onValue, off, set } from 'firebase/database';\r\n\r\n// Конфигурация Firebase\r\nconst firebaseConfig = {\r\n    databaseURL: 'https://mining-monitor-api-default-rtdb.firebaseio.com/'\r\n};\r\n\r\n// Инициализация Firebase\r\nconst app = initializeApp(firebaseConfig);\r\nexport const database = getDatabase(app);\r\n\r\nexport class MiningMonitorAPI {\r\n    constructor(farmName) {\r\n        this.farmName = farmName;\r\n        this.listeners = new Map();\r\n    }\r\n\r\n    // Реальная подписка на данные фермы\r\n    subscribeToFarmData(callback) {\r\n        const farmRef = ref(database, `farms/${this.farmName}`);\r\n        \r\n        const unsubscribe = onValue(farmRef, (snapshot) => {\r\n            const data = snapshot.val();\r\n            callback(data);\r\n        }, (error) => {\r\n            console.error('Ошибка подписки на данные фермы:', error);\r\n        });\r\n\r\n        this.listeners.set('farmData', unsubscribe);\r\n        return unsubscribe;\r\n    }\r\n\r\n    // Подписка на данные майнеров\r\n    subscribeToMiners(callback) {\r\n        const minersRef = ref(database, `miners/${this.farmName}`);\r\n        \r\n        const unsubscribe = onValue(minersRef, (snapshot) => {\r\n            const data = snapshot.val();\r\n            callback(data);\r\n        }, (error) => {\r\n            console.error('Ошибка подписки на данные майнеров:', error);\r\n        });\r\n\r\n        this.listeners.set('miners', unsubscribe);\r\n        return unsubscribe;\r\n    }\r\n\r\n    // Подписка на оповещения\r\n    subscribeToAlerts(callback) {\r\n        const alertsRef = ref(database, `alerts/${this.farmName}`);\r\n        \r\n        const unsubscribe = onValue(alertsRef, (snapshot) => {\r\n            const data = snapshot.val();\r\n            callback(data || {});\r\n        }, (error) => {\r\n            console.error('Ошибка подписки на оповещения:', error);\r\n        });\r\n\r\n        this.listeners.set('alerts', unsubscribe);\r\n        return unsubscribe;\r\n    }\r\n\r\n    // Отметить оповещение как прочитанное\r\n    markAlertRead(alertId) {\r\n        const alertRef = ref(database, `alerts/${this.farmName}/${alertId}/read`);\r\n        set(alertRef, true).catch(error => {\r\n            console.error('Ошибка отметки оповещения:', error);\r\n        });\r\n    }\r\n\r\n    // Отправить команду майнеру\r\n    sendMinerCommand(minerIp, command) {\r\n        const commandRef = ref(database, `commands/${this.farmName}/${minerIp}`);\r\n        return set(commandRef, {\r\n            command: command,\r\n            timestamp: Date.now(),\r\n            status: 'pending'\r\n        });\r\n    }\r\n\r\n    // Отписаться от всех обновлений\r\n    unsubscribeAll() {\r\n        this.listeners.forEach((unsubscribe, key) => {\r\n            unsubscribe();\r\n            console.log(`Отписались от: ${key}`);\r\n        });\r\n        this.listeners.clear();\r\n    }\r\n\r\n    // Получить историю данных\r\n    getHistoricalData(days = 7) {\r\n        // Здесь можно добавить логику для получения исторических данных\r\n        return new Promise((resolve) => {\r\n            resolve([]);\r\n        });\r\n    }\r\n}\r\n\r\n// Вспомогательные функции\r\nexport const formatHashrate = (hashrate) => {\r\n    if (!hashrate) return '0 TH/s';\r\n    \r\n    if (hashrate >= 1000) {\r\n        return `${(hashrate / 1000).toFixed(2)} PH/s`;\r\n    }\r\n    return `${hashrate.toFixed(2)} TH/s`;\r\n};\r\n\r\nexport const formatPower = (power) => {\r\n    if (!power) return '0 Вт';\r\n    \r\n    if (power >= 1000) {\r\n        return `${(power / 1000).toFixed(1)} кВт`;\r\n    }\r\n    return `${power} Вт`;\r\n};\r\n\r\nexport const calculateEfficiency = (hashrate, power) => {\r\n    if (!hashrate || !power || power === 0) return 0;\r\n    return (hashrate / power) * 1000; // J/TH\r\n};\r\n\r\nexport const getStatusColor = (status) => {\r\n    const colors = {\r\n        online: '#10b981',\r\n        offline: '#ef4444',\r\n        problematic: '#f59e0b',\r\n        warning: '#f59e0b',\r\n        critical: '#dc2626'\r\n    };\r\n    return colors[status] || '#6b7280';\r\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}